# Market Bots

Cобытийно-ориентированный фреймворк на Python для разработки, бэктестинга и (в будущем) запуска алгоритмических торговых стратегий в sandbox и live режимах на Tinkoff бирже (возможно на криптобиржах)

## О проекте
Предназначен для проверки торговых идей на исторических данных.

**Текущие возможности:**
*   **Базовый бэктестер:** Базовая симуляция работы стратегии на исторических данных свеча за свечой.
*   **Работа с локальными данными:** Бэктест проводится на предварительно скачанных данных.
*   **Возможность скачивания исторических данных** Скачивание происходит через API Tinkoff
*   **Возможность добавления стратегий:** Добавление новых стратегий созданием файла с новым классом, наследующим абстрактный базовый класса.
*   **Базовый анализ:** Генерация отчетов с ключевыми метриками (PnL, Win Rate, Max Drawdown и др.) и графиком капитала.
*   **Массовое тестирование:** Возможность запуска одной стратегии сразу на множестве скачанных инструментов.


## Архитектура

Основной принцип работы фреймворка — разделение логики на независимые компоненты, которые общаются через центральную очередь событий.

![Схема архитектуры](docs/WorkFlow.png)


## Быстрый старт

Тестировал на Python 3.12.10.

Клонируйте репозиторий и установите все необходимые зависимости в виртуальное окружение.


Model
Понял задачу. Максимальная практичность и ясность для пользователя. Вот обновленная версия `README.md`, которая точно следует твоим инструкциям. Я убрал "рекламные" формулировки и добавил четкий раздел по конфигурации.

---
### НАЧАЛО README.MD
---

# Market Bots

Cобытийно-ориентированный фреймворк на Python для разработки и бэктестинга алгоритмических торговых стратегий.

## О проекте

Этот фреймворк предназначен для проверки торговых идей на исторических данных.

**Текущие возможности:**
*   **Бэктестер:** Симуляция работы стратегии на исторических данных свеча за свечой.
*   **Работа с локальными данными:** Бэктест проводится на предварительно скачанных файлах для скорости и повторяемости результатов.
*   **Загрузчик данных:** Утилита для скачивания исторических данных через API Tinkoff.
*   **Модульные стратегии:** Возможность легко добавлять новые стратегии.
*   **Анализ результатов:** Генерация отчетов с ключевыми метриками (PnL, Win Rate, Max Drawdown и др.) и графиком капитала.
*   **Массовое тестирование:** Запуск одной стратегии сразу на множестве инструментов.

## Архитектура

Основной принцип работы — разделение логики на независимые компоненты, которые общаются через центральную очередь событий.

![Схема архитектуры](docs/WorkFlow.png)

## Быстрый старт

**Требования:** Python 3.12.10 (тестировалось на этой версии).

### 1. Установка

```bash
# 1. Клонировать репозиторий
git clone https://github.com/UseUseless/market_bots.git
cd market_bots

# 2. Создать и активировать виртуальное окружение
python -m venv .venv
# Для Linux/MacOS:
source .venv/bin/activate
# Для Windows:
# .venv\Scripts\activate

# 3. Установить зависимости
pip install -r requirements.txt
```

### Конфигурация

Для работы с API Tinkoff необходимо получить токен.

1.  Скопируйте файл `.env.example` и переименуйте его в `.env`.
2.  Откройте файл `.env` и вставьте свои токены. Для работы фреймворка **обязательно** нужен `TINKOFF_TOKEN_READONLY`.

## Порядок работы

### Шаг 1: Настройка параметров (config.py)

Все основные настройки находятся в файле `config.py`. **Перед началом работы откройте этот файл и настройте его под себя.**


### Шаг 2: Скачивание данных

Используйте скрипт `download_data.py` для скачивания исторических данных. Период загрузки и папка для сохранения настраиваются в `config.py`.

**Пример:** Скачать 5-минутные свечи для Сбербанка (`BBG004730N88`).
```bash
python download_data.py --figi BBG004730N88 --interval 5min
```
*   `--figi`: Один или несколько FIGI через пробел.
*   `--interval`: Таймфрейм (`1min`, `5min`, `15min`, `1hour`, `1day`).

### Шаг 3: Создание своей стратегии

1.  Создайте Python-файл в папке `strategies/`.
2.  Создайте в нем класс, наследуемый от `BaseStrategy`.
3.  Добавьте секцию для вашей стратегии в `STRATEGY_CONFIG` в файле `config.py`.
4.  Реализуйте обязательные свойства и методы, считывая параметры из конфига.

    *   **Свойства:** `@property` для `candle_interval`, `stop_loss_percent`, `take_profit_percent`.
    *   **Методы:** `prepare_data` (расчет индикаторов) и `calculate_signals` (торговая логика).

5.  Импортируйте и зарегистрируйте свою стратегию в `AVAILABLE_STRATEGIES` в файле `run.py`.

### Шаг 4: Запуск бэктеста

#### Запуск для одного инструмента
```bash
# Пример: Запустить triple_filter на Сбербанке
python run.py --mode backtest --strategy triple_filter --figi BBG004730N88
```

#### Массовый запуск
```bash
# Пример: Запустить triple_filter на всех 5-минутных данных
python batch_tester.py --strategy triple_filter --interval 5min
```

## Результаты работы

Папки для результатов настраиваются в `PATH_CONFIG` в файле `config.py`. По умолчанию:

*   `data/`: Скачанные исторические данные.
*   `logs/`: Логи выполнения (`_run.log`) и сделок (`_trades.csv`).
*   `reports/`: Графические отчеты (`.png`).

## Кастомизация анализа

Логика расчета метрик и построения графика находится в файле `analyzer.py`. Вы можете изменить или добавить новые метрики в методе `calculate_metrics` класса `BacktestAnalyzer`.