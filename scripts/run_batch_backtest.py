import argparseimport logging# 1. Импортируем нашу новую, централизованную функцию-оркестраторfrom app.flows.batch_backtest_flow import run_batch_backtest_flow# 2. Импортируем необходимые компоненты для настройки парсера аргументовfrom app.strategies import AVAILABLE_STRATEGIESfrom app.core.risk.risk_manager import AVAILABLE_RISK_MANAGERSfrom app.utils.logging_setup import setup_global_logging# 3. Получаем логгер для этого конкретного модуляlogger = logging.getLogger(__name__)def main():    """    Точка входа для запуска пакетного бэктеста из командной строки.    Эта функция только парсит аргументы и передает их в основной "flow" (поток),    где и происходит вся работа.    """    # Настраиваем логирование для корректной работы с progress bar (tqdm)    setup_global_logging(mode='tqdm', log_level=logging.INFO)    parser = argparse.ArgumentParser(        description="Запуск пакетного тестирования стратегии на всех доступных инструментах для заданного интервала."    )    # --- Аргументы командной строки остаются без изменений ---    parser.add_argument(        "--strategy",        type=str,        required=True,        choices=list(AVAILABLE_STRATEGIES.keys()),        help="Имя стратегии для тестирования."    )    parser.add_argument(        "--exchange",        type=str,        required=True,        choices=['tinkoff', 'bybit'],        help="Биржа, на данных которой проводится тест."    )    parser.add_argument(        "--interval",        type=str,        required=True,        help="Интервал данных (например, '5min', '1hour'). Папка с этим именем должна существовать."    )    parser.add_argument(        "--rm",        dest="risk_manager_type",        type=str,        default="FIXED",        choices=list(AVAILABLE_RISK_MANAGERS.keys()),        help="Модель управления риском. По умолчанию: FIXED."    )    args = parser.parse_args()    # 4. Конвертируем Namespace от argparse в обычный словарь    settings = vars(args)    try:        # 5. Вызываем нашу централизованную функцию, передавая ей все настройки        run_batch_backtest_flow(settings)    except Exception as e:        # Ловим любые непредвиденные ошибки на самом верхнем уровне        logger.critical(f"Произошла критическая ошибка при запуске потока пакетного тестирования: {e}", exc_info=True)if __name__ == "__main__":    main()