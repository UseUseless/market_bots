"""
CLI-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ú–æ–Ω–∏—Ç–æ—Ä–∞ –°–∏–≥–Ω–∞–ª–æ–≤ (Live Signal Monitor).

–≠—Ç–æ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (`LiveOrchestrator`), –∫–æ—Ç–æ—Ä—ã–π:
1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –≤–µ–±—Å–æ–∫–µ—Ç–∞–º –±–∏—Ä–∂ (Tinkoff/Bybit).
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã.
4. –†–∞—Å—Å—ã–ª–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –¢–µ–ª–µ–≥—Ä–∞–º (–∏–ª–∏ –¥—Ä—É–≥–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã).

–í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ —Ç–æ—Ä–≥–æ–≤–ª—è (–æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ä–¥–µ—Ä–æ–≤) –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞
–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫, –Ω–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.

–ó–∞–ø—É—Å–∫:
    python scripts/run_signals.py
"""

import argparse
import logging
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞ –≤ sys.path
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from app.core.engine.live.orchestrator import run_live_monitor_flow
from app.shared.logging_setup import setup_global_logging


def main() -> None:
    """
    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞.

    –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:
    1. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å –∏ —Ñ–∞–π–ª).
    2. –ü–∞—Ä—Å–∏—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (–ø–æ–∫–∞ –±–∞–∑–æ–≤—ã–µ, –Ω–æ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ).
    3. –ü–µ—Ä–µ–¥–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ `run_live_monitor_flow`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç
       Event Loop (asyncio) –∏ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (Telegram Bot, Data Feed, Strategy Engine).
    """
    setup_global_logging()

    parser = argparse.ArgumentParser(
        description="–ó–∞–ø—É—Å–∫ –ú–æ–Ω–∏—Ç–æ—Ä–∞ –°–∏–≥–Ω–∞–ª–æ–≤ (Signal Monitor).",
        formatter_class=argparse.ArgumentDefaultsHelpFormatter
    )

    # –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:
    # parser.add_argument("--dry-run", action="store_true", help="–ó–∞–ø—É—Å–∫ –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–æ–Ω–Ω–µ–∫—Ç–æ–≤")
    # parser.add_argument("--verbose", action="store_true", help="–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ")

    args = parser.parse_args()

    try:
        # –ü–µ—Ä–µ–¥–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä—è) –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫
        run_live_monitor_flow(vars(args))

    except KeyboardInterrupt:
        print("\nüõë –ú–æ–Ω–∏—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")
        sys.exit(0)
    except Exception as e:
        logging.getLogger(__name__).critical(
            f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ —Ä–∞–±–æ—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∞: {e}", exc_info=True
        )
        sys.exit(1)


if __name__ == "__main__":
    main()