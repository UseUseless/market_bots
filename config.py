import os
from dotenv import load_dotenv

# Загружаем переменные окружения из файла .env
load_dotenv()

# --- API Токены ---
TOKEN_READONLY = os.getenv("TINKOFF_TOKEN_READONLY")
TOKEN_FULL_ACCESS = os.getenv("TINKOFF_TOKEN_FULL_ACCESS")
TOKEN_SANDBOX = os.getenv("TINKOFF_TOKEN_SANDBOX")
ACCOUNT_ID = os.getenv("TINKOFF_ACCOUNT_ID")

# --- ОБЩИЕ НАСТРОЙКИ ФРЕЙМВОРКА ---

# Пути к директориям
PATH_CONFIG = {
    "DATA_DIR": "data",       # Папка для хранения исторических данных в формате .parquet.
    "LOGS_DIR": "logs",       # Папка для хранения логов выполнения (.log) и сделок (.csv).
    "REPORTS_DIR": "reports", # Папка для хранения графических отчетов анализа (.png).
}

# Настройки для загрузчика данных (download_data.py)
DATA_LOADER_CONFIG = {
    # Количество дней истории, которое будет загружено по умолчанию,
    # если не указать флаг --days при запуске download_data.py.
    "DAYS_TO_LOAD": 365
}

# Настройки для бэктестера (portfolio.py)
BACKTEST_CONFIG = {
    # Начальный капитал для симуляции. От этого значения зависит расчет размера позиций.
    "INITIAL_CAPITAL": 100000.0,
    # Размер комиссии брокера в долях. 0.0005 = 0.05%.
    # Учет комиссии критически важен для реалистичности бэктеста.
    "COMMISSION_RATE": 0.0005,
    # Настройки симуляции проскальзывания (slippage).
    # Проскальзывание - разница между ожидаемой ценой сделки и реальной ценой исполнения.
    "SLIPPAGE_CONFIG": {
        # Глобальный "рубильник" для модели проскальзывания.
        # Позволяет быстро сравнивать результаты с/без учета проскальзывания.
        "ENABLED": True,
        # Коэффициент влияния на цену. Это эмпирический параметр для нашей модели.
        # Чем он больше, тем сильнее наша сделка "двигает" цену против нас.
        # 0.1 - это умеренное, консервативное значение.
        "IMPACT_COEFFICIENT": 0.1,
    },
}
# Настройки для управления риском и размером позиции
RISK_CONFIG = {
    # Процент риска от капитала по умолчанию. Это ключевой параметр для контроля убытков.
    # Например, 1% означает, что при срабатывании стоп-лосса мы потеряем не более 1% от текущего капитала.
    # Мы разделяем их для лонга и шорта, так как можем захотеть рисковать по-разному
    # в зависимости от направления рынка (например, быть более консервативными в шортах).
    "DEFAULT_RISK_PERCENT_LONG": 3,
    "DEFAULT_RISK_PERCENT_SHORT": 2,

    # Коэффициент для расчета тейк-профита в FixedRiskManager.
    # Это значение определяет соотношение риска к прибыли (Risk/Reward Ratio).
    # Например, значение 2.0 означает, что потенциальная прибыль (расстояние до тейк-профита)
    # в 2 раза больше потенциального убытка (расстояния до стоп-лосса).
    # Таким образом, мы получаем R/R Ratio = 1:2.
    # Если у стратегии соотношение риска к прибыли 2:1, ей достаточно быть правой всего в 34% случаев, чтобы быть безубыточной (в теории, без учета комиссий).
    # Любой процент выигрышных сделок (Win Rate) выше этого значения будет приносить прибыль.
    # Если бы tp_ratio был 1.0 (соотношение 1:1), стратегии нужно было бы выигрывать более 50% сделок, чтобы быть прибыльной.
    "FIXED_TP_RATIO": 2.0,

    # Параметры для модели управления риском на основе ATR (AtrRiskManager).
    "ATR_PERIOD": 14,           # Стандартный период для расчета индикатора ATR.
    "ATR_MULTIPLIER_SL": 4.0,   # Множитель для стоп-лосса. SL = цена_входа - (ATR * этот_множитель).
                                # Чем больше значение, тем дальше (безопаснее, но и дороже) стоп.
    "ATR_MULTIPLIER_TP": 8.0,   # Множитель для тейк-профита. TP = цена_входа + (ATR * этот_множитель).
                                # Соотношение TP/SL здесь 4.0/2.0 = 2, что дает нам Risk/Reward Ratio 1:2.
}

# --- НАСТРОЙКИ КОНКРЕТНЫХ СТРАТЕГИЙ ---
# Свой собственный словарь с настройками для каждой стратегии.
STRATEGY_CONFIG = {
    "TripleFilterStrategy": {
        "candle_interval": "5min", # Рекомендуемый свечной интервал
        # Специфичные параметры для этой стратегии
        "ema_fast_period": 9,
        "ema_slow_period": 21,
        "ema_trend_period": 200,
        "volume_sma_period": 20,
    },
}